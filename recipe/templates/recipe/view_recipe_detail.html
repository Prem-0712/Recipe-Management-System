{% extends "core/base.html" %}
{% load static %}

{% block content %}
<div class='max-w-screen-xl mx-auto p-6 md:px-10 md:py-10 rounded-md'>
    <h1 class='mb-10 text-2xl font-bold text-center text-white'>Recipe Detail</h1>

    <div class='grid md:grid-cols-2 gap-6'>
        <!-- Left side: image -->
        <div class='md:col-span-1'>
            <img src="{{ recipe.image.url }}" alt="recipe image" class="rounded w-full object-cover max-h-96">
        </div>

        <!-- Right side: tabs -->
        <div class='md:col-span-1'>
            <div class="mb-4 border-b border-gray-200 dark:border-gray-700">
                <ul class="flex flex-wrap -mb-px text-sm font-medium text-center" id="tab-list" role="tablist">
                    <li class="me-2" role="presentation">
                        <button class="tab-btn inline-block p-4 border-b-2 rounded-t-lg border-blue-600 text-blue-600" 
                                id="Details-tab" type="button"
                                data-tab="Details"
                                aria-selected="true">
                            Details
                        </button>
                    </li>
                    <li class="me-2" role="presentation">
                        <button class="tab-btn inline-block p-4 border-b-2 rounded-t-lg hover:text-gray-300 hover:border-gray-300" 
                                id="description-tab" type="button"
                                data-tab="description"
                                aria-selected="false">
                            Description
                        </button>
                    </li>
                    <li class="me-2" role="presentation">
                        <button class="tab-btn inline-block p-4 border-b-2 rounded-t-lg hover:text-gray-300 hover:border-gray-300" 
                                id="ingrediants-tab" type="button"
                                data-tab="ingrediants"
                                aria-selected="false">
                            Ingredients
                        </button>
                    </li>
                    <li role="presentation">
                        <button class="tab-btn inline-block p-4 border-b-2 rounded-t-lg hover:text-gray-300 hover:border-gray-300" 
                                id="instructions-tab" type="button"
                                data-tab="instructions"
                                aria-selected="false">
                            Instructions
                        </button>
                    </li>
                </ul>
            </div>

            <!-- Tab contents -->
            <div id="tab-content">
                <!-- Details tab -->
                <div class="tab-panel p-4 rounded-lg bg-gray-50 dark:bg-gray-800 text-white" 
                    id="Details" role="tabpanel" aria-labelledby="Details-tab" style="display: block;">
                    <div class='flex flex-col space-y-2'>
                        <h2 class="text-lg font-semibold">Name: <span class="font-normal">{{ recipe.name }}</span></h2>
                        <p>Author: {{ recipe.created_by }}</p>
                    </div>
                </div>

                <!-- Description tab -->
                <div class="tab-panel p-4 rounded-lg bg-gray-50 dark:bg-gray-800 text-white" 
                    id="description" role="tabpanel" aria-labelledby="description-tab" style="display: none;">
                    {{ recipe.description }}
                </div>

                <!-- Ingredients tab -->
                <div class="tab-panel p-4 rounded-lg bg-gray-50 dark:bg-gray-800 text-white" 
                    id="ingrediants" role="tabpanel" aria-labelledby="ingrediants-tab" style="display: none;">
                    {% if ing %}
                        <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
                            <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">Name</th>
                                        {% if request.user == recipe.created_by %}
                                            <th scope="col" class="px-6 py-3"><span class="sr-only">Edit</span></th>
                                            <th scope="col" class="px-6 py-3"><span class="sr-only">Delete</span></th>
                                        {% endif %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for i in ing %}
                                        <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600">
                                            <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                                                {{ i.name }}
                                            </th>
                                            {% if request.user == recipe.created_by %}
                                                <td class="px-6 py-4 text-right">
                                                    <a href="{% url "recipe:create_ingrediants" recipe.id %}" class="font-medium text-blue-600 dark:text-blue-500 hover:underline">ADD</a>
                                                </td>
                                                <td class="px-6 py-4 text-right">
                                                    <a href="{% url "recipe:update_ingrediants" recipe.id i.id  %}" class="font-medium text-blue-600 dark:text-blue-500 hover:underline">Edit</a>
                                                </td>
                                                <td class="px-6 py-4 text-right">
                                                    <a href="{% url 'recipe:delete_ingrediants' id_of_recipe=recipe.id id=i.id %}" class="font-medium text-blue-600 dark:text-red-500 hover:underline">Delete</a>
                                                </td>
                                            {% endif %}
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        {% else %}

                            {% if request.user == recipe.created_by %}
                            <td class="px-6 py-4 text-right">
                                <a href="{% url "recipe:create_ingrediants" recipe.id %}" class="font-medium text-blue-600 dark:text-blue-500 hover:underline">ADD</a>
                            </td>
                            
                            {% endif %}
                    {% endif %}
                </div>


                <!-- Instructions tab -->
                <div class="tab-panel p-4 rounded-lg bg-gray-50 dark:bg-gray-800 text-white" 
                    id="instructions" role="tabpanel" aria-labelledby="instructions-tab" style="display: none;">
                    {% if ins %}
                        <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
                            <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">
                                            Step number
                                        </th>
                                        <th scope="col" class="px-6 py-3">
                                            Instructions
                                        </th>

                                        {% if request.user == recipe.created_by %}
                                        <th scope="col" class="px-6 py-3">
                                            <span class="sr-only">Edit</span>
                                        </th>
                                        <th scope="col" class="px-6 py-3">
                                            <span class="sr-only">Delete</span>
                                        </th>
                                        {% endif %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for i in ins %}
                                        <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600">
                                            <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                                                {{i.step_number}}
                                            </th>
                                            <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                                                {{i.instruction_text}}
                                            </th>

                                            {% if request.user == recipe.created_by %}
                                            <td class="px-6 py-4 text-right">
                                                <a href="{% url "recipe:update_instruction" recipe.id i.id %}" class="font-medium text-blue-600 dark:text-blue-500 hover:underline">Edit</a>
                                            </td>
                                            <td class="px-6 py-4 text-right">
                                                <a href="{% url "recipe:delete_instructions" recipe.id i.id %}"class="font-medium text-blue-600 dark:text-red-500 hover:underline">Delete</a>
                                            </td>
                                            {% endif %}
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div> 

                        {% else %}
                            {% if request.user == recipe.created_by %}
                                <td class="px-6 py-4 text-right">
                                    <a href="{% url "recipe:create_instruction" recipe.id %}" class="font-medium text-blue-600 dark:text-blue-500 hover:underline">ADD</a>
                                </td>
                            {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tab switching JS -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    const tabs = document.querySelectorAll(".tab-btn");
    const tabPanels = document.querySelectorAll(".tab-panel");

    tabs.forEach(tab => {
        tab.addEventListener("click", function() {
            // Remove active styles
            tabs.forEach(t => t.classList.remove("border-blue-600", "text-blue-600"));
            tabs.forEach(t => t.setAttribute("aria-selected", "false"));

            // Activate clicked tab
            this.classList.add("border-blue-600", "text-blue-600");
            this.setAttribute("aria-selected", "true");

            // Hide all panels
            tabPanels.forEach(panel => panel.style.display = "none");

            // Show selected
            const tabName = this.getAttribute("data-tab");
            document.getElementById(tabName).style.display = "block";
        });
    });
});
</script>
{% endblock content %}
